<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dispatch Report</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }

  h2 {
    margin-bottom: 15px;
  }

  .container {
    display: flex;
    gap: 20px;
  }

  .left {
    width: 25%;
  }

  .right {
    width: 75%;
  }

  select {
    width: 100%;
    padding: 8px;
    font-size: 14px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }

  th {
    background-color: #f4f4f4;
  }
</style>
</head>

<body>

<h2>Dispatch Report</h2>

<div class="container">

  <!-- LEFT -->
  <div class="left">
    <label><strong>Select Dispatch Date</strong></label><br><br>
    <select id="dateDropdown">
      <option value="">-- Select Date --</option>
    </select>
  </div>

  <!-- RIGHT -->
  <div class="right">
    <table>
      <thead>
        <tr>
          <th>Cattle Tag</th>
          <th>Dispatch Date</th>
          <th>Company</th>
          <th>Days at Farm</th>
          <th>Final Wt</th>
          <th>Yield</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td colspan="6">Select a dispatch date</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<script>
  const SHEET_ID = "1gAA5xw5PujEoKdw1SEWgmsGXY6OSCRZqLmsQ6do-1gc";
  const SHEET_URL =
    const SHEET_URL =
  `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&tq=select%20*`;
  let sheetData = [];

  // Fetch data from Google Sheet
  fetch(SHEET_URL)
    .then(res => res.text())
    .then(text => {
      const json = JSON.parse(text.substring(47).slice(0, -2));
      sheetData = json.table.rows.map(r =>
        r.c.map(c => c ? c.v : "")
      );
      loadDropdown();
    });

  // Populate dropdown
  function loadDropdown() {
    const dropdown = document.getElementById("dateDropdown");

    // Dispatch Date column index = 1
    const uniqueDates = [...new Set(sheetData.map(row => row[1]))];

    uniqueDates.forEach(date => {
      const opt = document.createElement("option");
      opt.value = date;
      opt.textContent = date;
      dropdown.appendChild(opt);
    });

    dropdown.addEventListener("change", showTable);
  }

  // Show filtered table
  function showTable() {
    const selectedDate = this.value;
    const tbody = document.getElementById("tableBody");
    let html = "";

    sheetData.forEach(row => {
      if (row[1] === selectedDate) {
        html += `
          <tr>
            <td>${row[0]}</td>
            <td>${row[1]}</td>
            <td>${row[2]}</td>
            <td>${row[8]}</td>
            <td>${row[9]}</td>
            <td>${row[10]}</td>
          </tr>
        `;
      }
    });

    tbody.innerHTML =
      html || `<tr><td colspan="6">No data found</td></tr>`;
  }
</script>

</body>
</html>

