<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dispatch Report</title>

<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
  }

  h2 {
    margin-bottom: 15px;
  }

  .container {
    display: flex;
    gap: 20px;
  }

  .left {
    width: 25%;
  }

  .right {
    width: 75%;
  }

  select {
    width: 100%;
    padding: 8px;
    font-size: 14px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
  }

  th, td {
    border: 1px solid #ccc;
    padding: 8px;
    text-align: center;
  }

  th {
    background-color: #f4f4f4;
  }
</style>
</head>

<body>

<h2>Dispatch Report</h2>

<div class="container">

  <!-- LEFT -->
  <div class="left">
    <label><strong>Select Dispatch Date</strong></label><br><br>
    <select id="dateDropdown">
      <option value="">-- Select Date --</option>
    </select>
  </div>

  <!-- RIGHT -->
  <div class="right">
    <table>
      <thead>
        <tr>
          <th>Cattle Tag</th>
          <th>Dispatch Date</th>
          <th>Company</th>
          <th>Days at Farm</th>
          <th>Final Wt</th>
          <th>Yield</th>
        </tr>
      </thead>
      <tbody id="tableBody">
        <tr>
          <td colspan="6">Select a dispatch date</td>
        </tr>
      </tbody>
    </table>
  </div>

</div>

<script>
  const CSV_URL =
    "https://docs.google.com/spreadsheets/d/e/2PACX-1vR_J4ku3OjCF-hOVgu1ftLRTne5-Y1lAIpZKAEckBWYEiL1o1Cv4PJ3_b97Xz3G_LC1RlsjE-ujoHSw/pub?output=csv";

  let sheetData = [];

  fetch(CSV_URL)
    .then(res => res.text())
    .then(csv => {
      const rows = parseCSV(csv);
      sheetData = rows.slice(1); // remove header
      loadDropdown();
    })
    .catch(err => {
      document.getElementById("tableBody").innerHTML =
        "<tr><td colspan='6'>Failed to load Google Sheet data</td></tr>";
      console.error(err);
    });

  // âœ… Proper CSV parser (handles commas in quotes)
  function parseCSV(text) {
    const rows = [];
    let row = [];
    let value = "";
    let insideQuotes = false;

    for (let i = 0; i < text.length; i++) {
      const char = text[i];
      const next = text[i + 1];

      if (char === '"' && insideQuotes && next === '"') {
        value += '"';
        i++;
      } else if (char === '"') {
        insideQuotes = !insideQuotes;
      } else if (char === "," && !insideQuotes) {
        row.push(value);
        value = "";
      } else if (char === "\n" && !insideQuotes) {
        row.push(value);
        rows.push(row);
        row = [];
        value = "";
      } else {
        value += char;
      }
    }

    if (value || row.length) {
      row.push(value);
      rows.push(row);
    }

    return rows.map(r => r.map(c => c.trim()));
  }

  function loadDropdown() {
    const dropdown = document.getElementById("dateDropdown");
    dropdown.innerHTML = `<option value="">-- Select Date --</option>`;

    const dates = [...new Set(sheetData.map(r => r[1]))].filter(Boolean);

    dates.forEach(date => {
      const opt = document.createElement("option");
      opt.value = date;
      opt.textContent = date;
      dropdown.appendChild(opt);
    });

    dropdown.addEventListener("change", showTable);
  }

  function showTable() {
  const selectedDate = this.value;
  const tbody = document.getElementById("tableBody");
  let html = "";

  sheetData.forEach(row => {
    if (row[1] === selectedDate) {
      html += "<tr>";
      row.forEach(cell => {
        html += `<td>${cell}</td>`;
      });
      html += "</tr>";
    }
  });

  tbody.innerHTML =
    html || "<tr><td colspan='20'>No data found</td></tr>";
}

</script>

</body>
</html>




